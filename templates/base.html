<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}{% endblock %}</title>
	<!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
  <link href="netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
  {% block additional_css %}{% endblock %}

</head>
<body>
  <nav class="navbar shadow navbar-expand-lg bg-body-tertiary fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Sima</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarSupportedContent">
            <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item {% if request.path == url_for('home') %}active{% endif %}">
                    <a class="nav-link" href="{{ url_for('home') }}">Home</a>
                </li>
                <li class="nav-item {% if request.path == url_for('feed') %}active{% endif %}">
                    <a class="nav-link" href="{{ url_for('feed') }}">Feed</a>
                </li>
            </ul>
            <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            </form>
            <ul class="navbar-nav ml-auto">
                {% if session.logged_in %}
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#createCommunitytModal">Make community</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#postModal">Post</a>
                  </li>
                {% else %}
                    <!-- Display the Log In button only if not logged in -->
                    <li class="nav-item">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">Log In</button>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

{% block content %}{% endblock %}

<!-- Modal for creating communities-->
<div class="modal fade" id="createCommunityModal" tabindex="-1" aria-labelledby="createCommunityModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createCommunityModalLabel">Create Community</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="/create_community">
          <div class="mb-3">
            <label for="communityName" class="form-label">Community Name</label>
            <input type="text" class="form-control" id="communityName" name="community_name" required>
          </div>
          <div class="mb-3">
            <label for="communityDesc" class="form-label">Description</label>
            <textarea class="form-control" id="communityDesc" name="description" rows="3"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Create</button>
        </form>
      </div>
    </div>
  </div>
</div>
      
<!-- Modal for making posts -->
<div class="modal fade" id="postModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        {% if session.logged_in %}
                    <div class="nav nav-justified nav-tabs mb-3" id="post-type-tabs" role="tablist">
                        <a class="nav-item nav-link active" id="text-tab" href="#text">Text</a>
                        <a class="nav-item nav-link" id="image-video-tab" href="#image-video">Image/Video</a>
                        <a class="nav-item nav-link" id="accordion-tab" href="#accordion">Accordion</a>
                    </div>

                    <div class="tab-content mb-2" id="post-type-tabs-content">
                        <div class="tab-pane fade show active" id="text" role="tabpanel" aria-labelledby="text-tab">
                          <form method="POST" action="/createpost" enctype="multipart/form-data">    
                            <input type="hidden" name="post_type" value="Text">                      
                            <div class="form-group">
                                <label for="text-title">Title:</label>
                                <input type="text" class="form-control" id="text-title" name="text-title">
                            </div>
                            <div class="form-group">
                                <label for="content">Content:</label>
                                <textarea class="form-control" id="content" name="content"></textarea>
                            </div>
                            <input type="submit" class="btn btn-primary" value="Submit">
                          </form>
                        </div>
                        <div class="tab-pane fade" id="image-video" role="tabpanel" aria-labelledby="image-video-tab">
                          <form method="POST" action="/createpost" enctype="multipart/form-data">
                            <input type="hidden" name="post_type" value="Media">
                            <div class="form-group">
                                <label for="image-title">Title:</label>
                                <input type="text" class="form-control" id="image-title" name="image-title">
                            </div>
                            <div class="form-group">
                                <label for="image-video-file">Image/Video:</label>
                                <input type="file" class="form-control-file" id="image-video-file" name="image-video-file" onchange="previewImage(event)" ondrop="dropImage(event)" ondragover="allowDrop(event)">
                                <div id="image-preview"></div>                            
                            </div>
                            <input type="submit" class="btn btn-primary" value="Submit">
                          </form>
                        </div>
                        <div class="tab-pane fade" id="accordion" role="tabpanel" aria-labelledby="accordion-tab">
                            Still under works
                        </div>
                    </div>

        {% else %}
            <h2>Login or Sign up if you wish to post</h2>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<!-- Login and Sign Up Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">

          <!-- Modal Header -->
          <div class="modal-header">
              <h5 class="modal-title" id="loginModalLabel">Log In</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <!-- Modal Body -->
          <div class="modal-body">
              <!-- Nav Tabs -->
              <ul class="nav nav-tabs" id="loginTabs" style="display: none;">
                  <li class="nav-item">
                      <a class="nav-link active" id="loginTab" data-bs-toggle="tab" href="#loginFormTab">Log In</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" id="signupTab" data-bs-toggle="tab" href="#signupFormTab">Sign Up</a>
                  </li>
              </ul>

              <div class="alert alert-warning" role="alert">
                Please don't put your actual information! This website is only up for experimental purpose and is not secure. You can use fake emails to log in as there will be no verification emails sent to validate.
              </div>

              <!-- Tab Content -->
              <div class="tab-content">
                  <!-- Login Form Tab -->
                  <div class="tab-pane fade show active" id="loginFormTab">
                      <form id="loginForm" action="/login" method="post">
                          <!-- Add your login form fields here -->
                          <div class="mb-3">
                              <label for="loginUsername" class="form-label">Username</label>
                              <input type="text" class="form-control" id="loginUsername" name="username" required>
                          </div>
                          <div class="mb-3">
                              <label for="loginPassword" class="form-label">Password</label>
                              <input type="password" class="form-control" id="loginPassword" name="password" required>
                          </div>
                          <button type="submit" class="btn btn-primary">Log In</button>
                          <p>Don't have an account? <a href="#" id="switchToSignUp" onclick="document.getElementById('signupTab').click()">Sign up!</a></p>
                      </form>
                  </div>

                  <!-- Sign Up Form Tab -->
                  <div class="tab-pane fade" id="signupFormTab">
                    <form id="signupForm" action="/signup" method="post">
                      <!-- Add your signup form fields here -->
                      <div class="mb-3">
                          <label for="signupUsername" class="form-label">Username</label>
                          <input type="text" class="form-control" id="signupUsername" name="username" required>
                      </div>
                      <div class="mb-3">
                          <label for="signupEmail" class="form-label">Email</label>
                          <input type="email" class="form-control" id="signupEmail" name="email" required>
                      </div>
                      <div class="mb-3">
                          <label for="signupPassword" class="form-label">Password</label>
                          <input type="password" class="form-control" id="signupPassword" name="password" required>
                      </div>
                      <div class="row">
                        <div class="mb-3 col-md-6">
                            <label for="signupFirstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="signupFirstName" name="first_name" required>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="signupLastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="signupLastName" name="last_name" required>
                        </div>
                    </div>
                    
                      <div class="mb-3">
                          <label for="signupBio" class="form-label">Bio</label>
                          <textarea class="form-control" id="signupBio" name="bio" rows="3" required></textarea>
                      </div>
                      <button type="submit" class="btn btn-success">Sign Up</button>
                      <p>Already have an account? <a href="#" id="switchToLogin" onclick="document.getElementById('loginTab').click()">Log in!</a></p>
                  </form>
                  
                  </div>
              </div>
          </div>

          <!-- Modal Footer -->
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>

      </div>
  </div>
</div>

	<!-- Bootstrap JS and jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>

      
<script>
        // Get the tabs and tab content elements
        const tabs = document.querySelectorAll('#post-type-tabs .nav-link');
        const tabContent = document.querySelectorAll('.tab-pane');
        const postTypeInput = document.querySelector('input[name="post_type"]');
      
        document.getElementById("image-video-tab").addEventListener("click", function() {
          document.getElementsByName("post_type")[0].value = "Image";
          console.log("validating")
        });
        
      
        // Loop through each tab and add an event listener to toggle the active class
        tabs.forEach(tab => {
          tab.addEventListener('click', e => {
            e.preventDefault();
            tabs.forEach(t => t.classList.remove('active'));
            e.target.classList.add('active');
            // Show the corresponding tab content
            const target = document.querySelector(e.target.getAttribute('href'));
            tabContent.forEach(tc => tc.classList.remove('show', 'active'));
            target.classList.add('show', 'active');
          });
        });
      
      
      
      function allowDrop(event) {
        event.preventDefault();
      }
      
      function dropImage(event) {
        event.preventDefault();
        var files = event.dataTransfer.files;
        var file = files[0];
      
        // Only process image files.
        if (!file.type.match('image.*')) {
          return;
        }
      
        var reader = new FileReader();
        reader.onload = function(e) {
          var imagePreview = document.getElementById("image-preview");
          var image = document.createElement("img");
          image.src = e.target.result;
          imagePreview.innerHTML = "";
          imagePreview.appendChild(image);
        };
        reader.readAsDataURL(file);
      }
      
      function previewImage(event) {
        var file = event.target.files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
          var imagePreview = document.getElementById("image-preview");
          var image = document.createElement("img");
          image.src = e.target.result;
          imagePreview.innerHTML = "";
          imagePreview.appendChild(image);
        };
        reader.readAsDataURL(file);
      }
      
      function previewImage(event) {
        const input = event.target;
        const previewContainer = document.getElementById("image-preview");
        previewContainer.innerHTML = ""; // Clear any previous preview
        
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const img = document.createElement("img");
            img.src = e.target.result;
            
            const deleteBtn = document.createElement("button");
            deleteBtn.innerHTML = "x";
            deleteBtn.classList.add("delete-btn");
            deleteBtn.addEventListener("click", function() {
              previewContainer.innerHTML = "";
              input.value = "";
            });
            
            previewContainer.appendChild(img);
            previewContainer.appendChild(deleteBtn);
          };
          
          reader.readAsDataURL(input.files[0]);
        }
      }


      document.addEventListener('DOMContentLoaded', function () {
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const switchToSignUp = document.getElementById('switchToSignUp');

        // Event listener to switch between Login and Sign Up forms
        switchToSignUp.addEventListener('click', function (event) {
            event.preventDefault();

            // Toggle display of Login and Sign Up forms
            if (loginForm.style.display === 'block') {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                document.getElementById('loginModalLabel').textContent = 'Sign Up';
            } else {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                document.getElementById('loginModalLabel').textContent = 'Log In';
            }
        });
    });
</script>

  <script src="{{ url_for('static', filename='js/base.js') }}"></script>